# Contexto da Feature: Chat e Status Operacional

## Vis√£o Geral
Esta feature gerencia a intera√ß√£o principal entre o usu√°rio e o assistente operacional "Carlos". Ela inclui o pipeline de mensagens, processamento de Markdown, detec√ß√£o de inten√ß√µes e a exibi√ß√£o de cards especializados de status operacional.

## Decis√µes de Design (2026)

### 1. Sistema de "Sem√°foro" e Legendas
- **L√≥gica**: Sempre que a interface detecta men√ß√µes a "N√≠vel 1" ou "N√≠vel 2" no corpo da mensagem, uma legenda de sem√°foro √© injetada automaticamente.
- **Mapeamento de N√≠veis**:
  - üü¢ **Normal**: Opera√ß√£o dentro dos par√¢metros.
  - üü° **N√≠vel 1: Aten√ß√£o**: Identifica√ß√£o de desvios iniciais.
  - üî¥ **N√≠vel 2: Cr√≠tico**: Necessidade de interven√ß√£o imediata.
- **Responsividade**: As legendas s√£o otimizadas para Desktop e Mobile (Mobile-First) usando `flex-wrap` e tamanhos de fonte escal√°veis.

### 2. Tratamento de Markdown e "Texto Quebrado"
- **Problema**: Modelos de linguagem podem quebrar negritos (`**texto\nquebrado**`) ou listas em streaming.
- **Solu√ß√£o**: O utilit√°rio `message-parser.ts` possui um `repairMarkdown` que:
  - Remove quebras de linha indevidas entre tags de negrito.
  - Consolida bullet points que foram indevidamente separados por m√∫ltiplas linhas vazias.
  - Fecha tags abertas durante o streaming.

### 3. Sanitiza√ß√£o e Anti-Rob√¥
- **Filtro de Metalanguage**: O frontend remove automaticamente frases burocr√°ticas como "Baseado no contexto fornecido" para manter a personalidade do assistente.
- **Tradu√ß√£o de Termos**: Termos como "threshold", "SLA", "KPI" e "Playbook" s√£o interceptados e nacionalizados para "limite", "prazo", "indicador" e "manual de procedimentos", garantindo acessibilidade a todos os n√≠veis operacionais.

### Moderniza√ß√£o H√≠brida (Estado Atual)
- **Header Responsivo**: L√≥gica de visibilidade condicional que adapta o branding conforme o dispositivo.
- **Input Area "Focus-Free"**: Remo√ß√£o total de marca√ß√µes de contorno amarelas ao digitar, garantindo um ambiente de trabalho limpo e imersivo.
- **Quick Actions Mobile-First**: Otimiza√ß√£o do scroll horizontal e `flex-shrink-0` para garantir que a√ß√µes r√°pidas nunca sejam cortadas em smartphones.
- **Est√©tica Grok-Lite**: Mantemos o estilo de "p√≠lula flutuante" e bot√µes circulares, mas integrados ao fundo original `treq-gray-50` para maior legibilidade.
    - **Branding Mobile vs Desktop**: 
    - No **Mobile**, a marca √© reduzida ao Logo e "Treq", priorizando espa√ßo vertical.
    - No **Desktop**, o t√≠tulo "Assistente Operacional" √© centralizado para manter a hierarquia corporativa.
- **Acessibilidade Personalizada**: O contorno de foco padr√£o (`ring-treq-yellow`) foi removido globalmente para evitar distra√ß√µes visuais, sendo substitu√≠do por estados discretos de hover e transi√ß√µes suaves.
- **Micro-intera√ß√µes**: Logo pulsante e transi√ß√µes suaves (`animate-fade-in`) para uma percep√ß√£o de produto premium e √°gil.

## Documenta√ß√£o de Prompts
- `alerta.yaml`: Focado em extra√ß√£o agressiva e in√≠cio mandat√≥rio com status.
- `metrica.yaml`: Foco em precis√£o decimal absoluta e compara√ß√£o vs gatilho.
- `procedimento.yaml`: Foco na s√≠ntese de m√∫ltiplos documentos sem referenciar nomes de arquivos.
- `consultoria.yaml`: Implementa a persona de "Carlos", tom conversacional e pr√°tico.
